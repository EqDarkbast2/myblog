MariaDB를 내부 네트워크에서 외부 또는 다른 장치에서 접근할 수 있도록 공개하려면 몇 가지 설정을 해야 합니다. 아래는 MariaDB를 외부 네트워크에서 접근할 수 있도록 설정하는 방법입니다.

### 1. MariaDB 설정 변경 (외부 접근 허용)
기본적으로 MariaDB는 로컬 호스트(127.0.0.1)에서만 접근을 허용합니다. 외부 네트워크에서 접근할 수 있도록 설정을 변경해야 합니다.

#### (1) MariaDB 설정 파일 수정
MariaDB의 설정 파일(`my.cnf`)을 수정하여 외부 IP에서 접근할 수 있도록 허용합니다.

1. MariaDB 설정 파일을 엽니다.

```bash
sudo nano /etc/mysql/mariadb.conf.d/50-server.cnf
```

2. `bind-address` 항목을 찾습니다. 기본적으로 `bind-address = 127.0.0.1`로 설정되어 있습니다. 이를 `0.0.0.0`으로 변경하여 모든 IP에서 접근할 수 있도록 합니다.

```ini
bind-address = 0.0.0.0
```

3. 파일을 저장하고 종료합니다. (`Ctrl+O`로 저장하고, `Ctrl+X`로 종료)

#### (2) MariaDB 서비스 재시작
설정을 변경한 후 MariaDB 서비스를 재시작하여 변경 사항을 적용합니다.

```bash
sudo systemctl restart mariadb
```

### 2. 방화벽 설정
MariaDB는 기본적으로 포트 3306을 사용합니다. 방화벽이 활성화되어 있는 경우, 외부 네트워크에서 해당 포트로 접근할 수 있도록 방화벽 설정을 변경해야 합니다.

#### (1) UFW (Uncomplicated Firewall) 사용 시
UFW를 사용하여 방화벽을 관리하는 경우, 3306 포트를 열어줘야 합니다.

```bash
sudo ufw allow 3306
```

그 후, 방화벽 상태를 확인하여 3306 포트가 열렸는지 확인합니다.

```bash
sudo ufw status
```

#### (2) iptables 사용 시
`iptables`로 방화벽을 설정하는 경우, 3306 포트를 열어줘야 합니다.

```bash
sudo iptables -A INPUT -p tcp --dport 3306 -j ACCEPT
```

변경 사항을 저장하려면 `iptables-save`를 사용합니다.

```bash
sudo iptables-save > /etc/iptables/rules.v4
```

### 3. MariaDB 사용자 권한 설정
외부에서 MariaDB에 접근하려면, 해당 사용자가 원격 접속 권한을 가져야 합니다. 이를 위해 MariaDB 사용자에게 접근 권한을 부여합니다.

1. MariaDB에 접속합니다.

```bash
sudo mysql -u root -p
```

2. 원격 접속할 사용자에 대해 적절한 권한을 부여합니다. 예를 들어, `myuser`라는 사용자가 `my_database` 데이터베이스에 원격에서 접근할 수 있도록 하려면 다음과 같이 설정합니다.

```sql
GRANT ALL PRIVILEGES ON my_database.* TO 'myuser'@'%' IDENTIFIED BY 'password';
```

- `'%'`는 모든 IP에서 접속을 허용하는 의미입니다. 특정 IP만 허용하려면 `'192.168.1.100'`과 같이 해당 IP를 입력합니다.
- `myuser`는 사용자의 이름, `password`는 사용자의 비밀번호입니다.

3. 권한 변경 사항을 적용합니다.

```sql
FLUSH PRIVILEGES;
```

4. MariaDB를 종료합니다.

```sql
exit;
```

### 4. 네트워크 접근 확인
이제 외부 네트워크에서 MariaDB에 접근할 수 있습니다. 예를 들어, 다른 장치에서 다음과 같이 연결할 수 있습니다.

```bash
mysql -u myuser -p -h <서버의_IP_주소> my_database
```

### 5. 추가 보안 설정 (선택 사항)
외부에서 데이터베이스를 접근할 수 있도록 허용하는 것은 보안 위험이 될 수 있습니다. 이를 방지하기 위해 아래와 같은 추가 보안을 고려할 수 있습니다.

- **방화벽**: MariaDB가 공개되는 네트워크를 제한하여 불필요한 외부 접근을 차단합니다.
- **SSH 터널링**: SSH 터널링을 사용하여 데이터베이스에 안전하게 접근합니다.
- **사용자 권한 최소화**: 필요한 권한만 부여하여 최소한의 접근만 허용합니다.
- **암호화**: MariaDB에 SSL/TLS를 설정하여 데이터를 암호화합니다.

위의 단계를 따라 MariaDB를 내부 네트워크에서 외부로 공개할 수 있습니다.



## SSH

네, SSH (Secure Shell)를 사용하여 MariaDB에 안전하게 원격으로 접근하는 방법도 매우 적합한 방식입니다. 특히, SSH 터널링을 활용하면 네트워크를 통해 데이터베이스를 안전하게 보호할 수 있습니다. SSH 터널링은 데이터를 암호화하여 전송하므로, 데이터가 중간에 유출될 위험을 줄일 수 있습니다.

### SSH 터널링을 사용하여 MariaDB에 원격 접속하는 방법

#### 1. SSH 터널링 개념
SSH 터널링은 로컬 시스템에서 원격 시스템의 특정 포트에 연결할 수 있도록 하는 방법입니다. MariaDB의 기본 포트인 3306을 SSH를 통해 안전하게 연결할 수 있습니다. 이를 통해 MariaDB 서버의 포트를 로컬 시스템의 포트로 매핑하여, 암호화된 연결을 통해 데이터베이스에 접근할 수 있습니다.

#### 2. SSH 터널링으로 MariaDB에 연결
다음은 SSH 터널링을 사용하여 MariaDB에 연결하는 방법입니다.

1. **SSH 터널링 생성**:
   로컬 컴퓨터에서 MariaDB 서버의 3306 포트에 안전하게 접근하려면 아래와 같은 명령어를 사용하여 SSH 터널을 만듭니다.

   ```bash
   ssh -L 3306:localhost:3306 user@remote-server-ip
   ```

   - `-L`: 로컬 포트와 원격 포트를 연결하는 옵션
   - `3306`: 로컬에서 사용할 포트 (MariaDB 기본 포트)
   - `localhost:3306`: 원격 서버에서의 MariaDB 포트
   - `user`: 원격 서버에서 사용하는 SSH 사용자 이름
   - `remote-server-ip`: 원격 서버의 IP 주소

   이 명령어는 원격 서버에 SSH로 연결하고, 원격 서버의 MariaDB 포트인 `3306`을 로컬 머신의 `3306` 포트로 매핑합니다.

2. **MariaDB에 접속**:
   이제, 로컬에서 MariaDB에 연결하려면 아래와 같이 연결할 수 있습니다.

   ```bash
   mysql -u myuser -p -h 127.0.0.1 my_database
   ```

   여기서:
   - `myuser`: MariaDB 사용자 이름
   - `127.0.0.1`: 로컬 시스템을 의미하며, SSH 터널링을 통해 원격 MariaDB에 연결
   - `my_database`: 연결할 MariaDB 데이터베이스 이름

   이 명령은 로컬에서 MariaDB를 연결하는 것처럼 보이지만, 실제로는 SSH 터널을 통해 원격 MariaDB 서버에 연결됩니다.

#### 3. SSH 키 인증을 사용하여 자동 로그인 설정 (선택 사항)
SSH 터널링을 설정할 때 매번 비밀번호를 입력하는 것이 번거로울 수 있습니다. 이를 해결하려면 SSH 키 인증을 사용할 수 있습니다. SSH 키 인증을 설정하려면 다음 단계를 따릅니다.

1. **로컬 시스템에서 SSH 키 생성**:

   ```bash
   ssh-keygen -t rsa -b 4096
   ```

2. **생성된 공개 키를 원격 서버로 복사**:

   ```bash
   ssh-copy-id user@remote-server-ip
   ```

3. SSH 키 인증을 사용하면 매번 비밀번호를 입력하지 않고도 SSH 터널링을 사용할 수 있습니다.

#### 4. SSH 터널링의 보안
SSH 터널링은 데이터를 암호화하여 전송하므로 중간에서 데이터가 유출될 위험이 줄어듭니다. 따라서, MariaDB의 포트를 외부 네트워크에 직접 열지 않고 SSH 터널을 통해 간접적으로 연결하는 것이 더 안전합니다.

또한, SSH 접속에 강력한 비밀번호 또는 SSH 키 인증을 사용하여 보안을 강화할 수 있습니다.

#### 5. MariaDB 외부 접속 차단
SSH 터널링을 사용할 때는 MariaDB 서버에서 외부의 직접적인 접속을 차단하는 것이 좋습니다. MariaDB의 `my.cnf` 파일에서 `bind-address`를 `127.0.0.1`로 설정하여 외부에서 직접 접속하지 못하도록 할 수 있습니다.

```ini
bind-address = 127.0.0.1
```

이렇게 하면 MariaDB는 SSH 터널을 통해서만 접근이 가능하게 됩니다.

### 결론
SSH 터널링을 사용하여 MariaDB에 원격으로 안전하게 접속하는 것은 좋은 방법입니다. 이를 통해 데이터베이스에 대한 접근을 암호화하고, 네트워크 상에서의 보안을 강화할 수 있습니다.

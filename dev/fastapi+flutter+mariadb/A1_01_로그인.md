# ì§ˆë¬¸
ì²˜ìŒí•œ ì§ˆë¬¸í•œ ë‚´ìš©ì„ ë² ì´ìŠ¤ë¡œ í´ë”êµ¬ì¡°ë¥¼ ì‘ì„±í•˜ê³  ë¡œê·¸ì¸ ì½”ë“œë¥¼ ë§Œë“¤ì–´ì¤˜

---

ì¢‹ìŠµë‹ˆë‹¤! ì²˜ìŒì— ìš”ì²­í•˜ì‹  ì „ì²´ ê¸°ëŠ¥(ë¡œê·¸ì¸, ìœ í‹¸ë©”ë‰´, ì¦ê¸¸ê±°ë¦¬ ë“±)ì„ ê³ ë ¤í•´ **FastAPI ë°±ì—”ë“œ ê¸°ì¤€ í´ë” êµ¬ì¡°**ë¥¼ ë¨¼ì € ì •ë¦¬í•˜ê³ , ì´ì–´ì„œ **ë¡œê·¸ì¸ ê¸°ëŠ¥ ê´€ë ¨ ì½”ë“œ**ë§Œ ì§‘ì¤‘ì ìœ¼ë¡œ ì‘ì„±í•´ë“œë¦´ê²Œìš”. ì „ì²´ êµ¬ì¡°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ëŠ¥ë³„ í™•ì¥ì´ ì‰½ë„ë¡ ì„¤ê³„í•©ë‹ˆë‹¤.

---

## ğŸ“ ì¶”ì²œ í´ë” êµ¬ì¡° (FastAPI ê¸°ë°˜)

```
project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py               â† ì•± ì‹œì‘ì 
â”‚   â”œâ”€â”€ core/                 â† ë³´ì•ˆ, ì„¤ì •, JWT ë“±
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ security.py
â”‚   â”œâ”€â”€ models/               â† SQLAlchemy ëª¨ë¸
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â”œâ”€â”€ schemas/              â† Pydantic ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â”œâ”€â”€ crud/                 â† DB ì¡°ì‘ ë¡œì§
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â”œâ”€â”€ api/                  â† ë¼ìš°í„° ëª¨ìŒ
â”‚   â”‚   â”œâ”€â”€ deps.py           â† ê³µí†µ ì˜ì¡´ì„± (í† í° ë“±)
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â””â”€â”€ auth.py       â† ë¡œê·¸ì¸/íšŒì›ê°€ì… ê´€ë ¨ ë¼ìš°í„°
â”‚   â”œâ”€â”€ db/                   â† DB ì—°ê²°
â”‚   â”‚   â”œâ”€â”€ database.py
â”‚   â”‚   â””â”€â”€ base.py
â””â”€â”€ requirements.txt
```

---

## âœ… ë¡œê·¸ì¸ ê´€ë ¨ ì½”ë“œ êµ¬ì„±

### 1. `app/core/config.py` â€“ ì„¤ì •ê°’

```python
import os

SECRET_KEY = os.getenv("SECRET_KEY", "super-secret-key")
ALGORITHM = "HS256"
ACCESS_TOKEN_EXPIRE_MINUTES = 60
```

---

### 2. `app/core/security.py` â€“ ë¹„ë°€ë²ˆí˜¸ í•´ì‹± ë° JWT

```python
from passlib.context import CryptContext
from datetime import datetime, timedelta
from jose import jwt, JWTError
from app.core.config import SECRET_KEY, ALGORITHM, ACCESS_TOKEN_EXPIRE_MINUTES

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def hash_password(password: str) -> str:
    return pwd_context.hash(password)

def verify_password(plain_password: str, hashed_password: str) -> bool:
    return pwd_context.verify(plain_password, hashed_password)

def create_access_token(data: dict, expires_delta: timedelta = None):
    to_encode = data.copy()
    expire = datetime.utcnow() + (expires_delta or timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES))
    to_encode.update({"exp": expire})
    return jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)

def decode_token(token: str):
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        return payload.get("sub")
    except JWTError:
        return None
```

---

### 3. `app/models/user.py` â€“ ì‚¬ìš©ì ëª¨ë¸

```python
from sqlalchemy import Column, Integer, String
from app.db.database import Base

class User(Base):
    __tablename__ = "users"

    id = Column(Integer, primary_key=True, index=True)
    username = Column(String(50), unique=True, index=True)
    email = Column(String(100), unique=True)
    hashed_password = Column(String(128))
```

---

### 4. `app/schemas/user.py` â€“ ì‚¬ìš©ì ìŠ¤í‚¤ë§ˆ

```python
from pydantic import BaseModel

class UserCreate(BaseModel):
    username: str
    email: str
    password: str

class UserOut(BaseModel):
    id: int
    username: str
    email: str

    class Config:
        orm_mode = True

class Token(BaseModel):
    access_token: str
    token_type: str
```

---

### 5. `app/crud/user.py` â€“ ì‚¬ìš©ì ê´€ë ¨ DB ì¡°ì‘

```python
from sqlalchemy.orm import Session
from app.models.user import User
from app.core.security import hash_password

def get_user_by_username(db: Session, username: str):
    return db.query(User).filter(User.username == username).first()

def create_user(db: Session, username: str, email: str, password: str):
    hashed_pw = hash_password(password)
    user = User(username=username, email=email, hashed_password=hashed_pw)
    db.add(user)
    db.commit()
    db.refresh(user)
    return user
```

---

### 6. `app/api/deps.py` â€“ í˜„ì¬ ìœ ì € ê°€ì ¸ì˜¤ê¸°

```python
from fastapi import Depends, HTTPException
from fastapi.security import OAuth2PasswordBearer
from sqlalchemy.orm import Session
from app.core.security import decode_token
from app.db.database import get_db
from app.models.user import User

oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/api/login")

def get_current_user(token: str = Depends(oauth2_scheme), db: Session = Depends(get_db)) -> User:
    username = decode_token(token)
    if not username:
        raise HTTPException(status_code=401, detail="Invalid token")
    user = db.query(User).filter(User.username == username).first()
    if not user:
        raise HTTPException(status_code=401, detail="User not found")
    return user
```

---

### 7. `app/api/routes/auth.py` â€“ ë¡œê·¸ì¸ ë¼ìš°í„°

```python
from fastapi import APIRouter, Depends, HTTPException
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.orm import Session
from app.db.database import get_db
from app.schemas.user import UserCreate, UserOut, Token
from app.models.user import User
from app.crud.user import get_user_by_username, create_user
from app.core.security import verify_password, create_access_token
from app.api.deps import get_current_user

router = APIRouter()

@router.post("/register", response_model=UserOut)
def register(user: UserCreate, db: Session = Depends(get_db)):
    if get_user_by_username(db, user.username):
        raise HTTPException(status_code=400, detail="Username already exists")
    return create_user(db, user.username, user.email, user.password)

@router.post("/login", response_model=Token)
def login(form_data: OAuth2PasswordRequestForm = Depends(), db: Session = Depends(get_db)):
    user = get_user_by_username(db, form_data.username)
    if not user or not verify_password(form_data.password, user.hashed_password):
        raise HTTPException(status_code=401, detail="Invalid credentials")
    token = create_access_token(data={"sub": user.username})
    return {"access_token": token, "token_type": "bearer"}

@router.get("/me", response_model=UserOut)
def get_me(current_user: User = Depends(get_current_user)):
    return current_user
```

---

### 8. `app/db/database.py` â€“ DB ì—°ê²°

```python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker

DATABASE_URL = "mysql+pymysql://user:password@localhost:3306/yourdb"

engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(bind=engine, autocommit=False, autoflush=False)
Base = declarative_base()

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

---

### 9. `app/main.py` â€“ ì•± ì‹¤í–‰ ì—”íŠ¸ë¦¬

```python
from fastapi import FastAPI
from app.api.routes import auth
from app.db import database, base

# DB í…Œì´ë¸” ìƒì„±
base.Base.metadata.create_all(bind=database.engine)

app = FastAPI()
app.include_router(auth.router, prefix="/api", tags=["auth"])
```

---

## âœ… ì‹¤í–‰

```bash
uvicorn app.main:app --reload
```

---

## â­ï¸ ë‹¤ìŒ ë‹¨ê³„

- Flutterì™€ ì´ ë¡œê·¸ì¸ API ì—°ë™
- ì‚¬ìš©ì ì„¸ì…˜ ìœ ì§€ ë° ìƒíƒœ ê´€ë¦¬
- ì‚¬ì´ë“œë°” ê¸°ëŠ¥ ì¶”ê°€ (ë¡œê·¸ì•„ì›ƒ, ìœ ì €ì •ë³´)

---

ì›í•˜ì‹œë©´ **Flutter ë¡œê·¸ì¸ í™”ë©´ ì½”ë“œë„ ë°”ë¡œ ì œê³µ**í•´ë“œë¦´ê²Œìš”. ê³„ì† ì§„í–‰í• ê¹Œìš”?

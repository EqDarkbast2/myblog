ì¢‹ì•„ìš”! ì „ì²´ì ì¸ í…œí”Œë¦¿ê³¼ í•¨ê»˜ ë³´ì•ˆ, JWT ì²˜ë¦¬, Nginx ë°°í¬ê¹Œì§€ í•œë²ˆì— ì •ë¦¬í•´ë“œë¦´ê²Œìš”.  

---

## ğŸ”§ ì „ì²´ ì†ŒìŠ¤ í…œí”Œë¦¿

ë””ë ‰í† ë¦¬ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

```
my_project/
â”œâ”€â”€ backend/         # FastAPI + MariaDB
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ models.py
â”‚   â”œâ”€â”€ database.py
â”‚   â”œâ”€â”€ auth.py
â”‚   â”œâ”€â”€ schemas.py
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ frontend/        # Flutter Web
â”‚   â””â”€â”€ ...          # Flutter í”„ë¡œì íŠ¸ ìƒì„±
â””â”€â”€ deploy/
    â””â”€â”€ nginx.conf   # Nginx ì„¤ì •
```

---

## ğŸ” ë¡œê·¸ì¸ ë³´ì•ˆ: ë¹„ë°€ë²ˆí˜¸ í•´ì‹±

### ì´ìœ :
- **ë¹„ë°€ë²ˆí˜¸ëŠ” í‰ë¬¸ìœ¼ë¡œ ì €ì¥í•˜ë©´ ì•ˆ ë¨.**
- ìœ ì €ê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ì™€ DBì— ì €ì¥ëœ í•´ì‹œë¥¼ ë¹„êµí•´ì•¼ í•¨.

### í•´ì‹œ í•¨ìˆ˜ ì‚¬ìš©
- `passlib.hash.bcrypt`ì„ ì‚¬ìš© (ë³´ì•ˆ ê°•ë ¥í•˜ê³  ì¼ë°˜ì )

```python
from passlib.hash import bcrypt

hashed = bcrypt.hash("user-password")
bcrypt.verify("user-password", hashed)  # True
```

---

## ğŸ›¡ï¸ JWT í† í°ì´ë€?

- **JWT (JSON Web Token)**: ë¡œê·¸ì¸í•œ ìœ ì €ë¥¼ ì‹ë³„í•˜ëŠ” í† í°
- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ í´ë¼ì´ì–¸íŠ¸ì— JWTë¥¼ ë°œê¸‰í•˜ê³ , ì´í›„ ìš”ì²­ë§ˆë‹¤ ì´ í† í°ìœ¼ë¡œ ì¸ì¦
- **ì¥ì **: ì„œë²„ê°€ ì„¸ì…˜ì„ ì €ì¥í•˜ì§€ ì•Šì•„ë„ ë¨ â†’ Stateless

### JWT êµ¬ì¡°:
`HEADER.PAYLOAD.SIGNATURE`  
(ì˜ˆ: `eyJhbGciOi...`)

---

## âœ… FastAPI ì „ì²´ ë°±ì—”ë“œ í…œí”Œë¦¿

### ğŸ”¹ `requirements.txt`

```
fastapi
uvicorn
sqlalchemy
pymysql
passlib[bcrypt]
python-jose[cryptography]
```

---

### ğŸ”¹ `database.py`

```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, declarative_base

SQLALCHEMY_DATABASE_URL = "mysql+pymysql://user:password@localhost/mydb"

engine = create_engine(SQLALCHEMY_DATABASE_URL)
SessionLocal = sessionmaker(bind=engine)
Base = declarative_base()

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

---

### ğŸ”¹ `models.py`

```python
from sqlalchemy import Column, Integer, String
from database import Base

class User(Base):
    __tablename__ = "users"
    id = Column(Integer, primary_key=True, index=True)
    email = Column(String(255), unique=True, index=True)
    password = Column(String(255))

class Notice(Base):
    __tablename__ = "notices"
    id = Column(Integer, primary_key=True)
    title = Column(String(255))
    content = Column(String)
```

---

### ğŸ”¹ `schemas.py`

```python
from pydantic import BaseModel

class UserLogin(BaseModel):
    email: str
    password: str

class Token(BaseModel):
    access_token: str
    token_type: str = "bearer"

class NoticeOut(BaseModel):
    title: str
    content: str
```

---

### ğŸ”¹ `auth.py` â€“ JWT ë° ì¸ì¦ ì²˜ë¦¬

```python
from datetime import datetime, timedelta
from jose import JWTError, jwt

SECRET_KEY = "your-secret-key"
ALGORITHM = "HS256"
ACCESS_TOKEN_EXPIRE_MINUTES = 30

def create_access_token(data: dict):
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)
    to_encode.update({"exp": expire})
    return jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)

def verify_token(token: str):
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        return payload
    except JWTError:
        return None
```

---

### ğŸ”¹ `main.py`

```python
from fastapi import FastAPI, Depends, HTTPException, Header
from sqlalchemy.orm import Session
from passlib.hash import bcrypt
import models, schemas, database, auth
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"], allow_credentials=True, allow_methods=["*"], allow_headers=["*"],
)

@app.post("/login", response_model=schemas.Token)
def login(data: schemas.UserLogin, db: Session = Depends(database.get_db)):
    user = db.query(models.User).filter(models.User.email == data.email).first()
    if not user or not bcrypt.verify(data.password, user.password):
        raise HTTPException(status_code=401, detail="Invalid credentials")
    token = auth.create_access_token(data={"sub": str(user.id)})
    return {"access_token": token}

@app.get("/notices", response_model=list[schemas.NoticeOut])
def get_notices(token: str = Header(...), db: Session = Depends(database.get_db)):
    payload = auth.verify_token(token)
    if not payload:
        raise HTTPException(status_code=403, detail="Invalid token")
    notices = db.query(models.Notice).all()
    return notices
```

---

## ğŸŒ í”„ë¡ íŠ¸ì—”ë“œ (Flutter Web)

Flutter Web í”„ë¡œì íŠ¸ëŠ” ê¸°ë³¸ ë¡œê·¸ì¸ í¼ê³¼ í† í° ì €ì¥ì— ëŒ€í•´ ë‹¤ìŒì²˜ëŸ¼ ì§„í–‰í•©ë‹ˆë‹¤:

### ğŸ”¹ ë¡œê·¸ì¸ ìš”ì²­

```dart
final response = await http.post(
  Uri.parse('http://localhost:8000/login'),
  body: jsonEncode({
    'email': emailController.text,
    'password': passwordController.text,
  }),
  headers: {'Content-Type': 'application/json'},
);

if (response.statusCode == 200) {
  final token = jsonDecode(response.body)['access_token'];
  await secureStorage.write(key: 'jwt', value: token);
  Navigator.pushNamed(context, '/home');
}
```

### ğŸ”¹ ê³µì§€ì‚¬í•­ ë¶ˆëŸ¬ì˜¤ê¸°

```dart
final token = await secureStorage.read(key: 'jwt');
final response = await http.get(
  Uri.parse('http://localhost:8000/notices'),
  headers: {'token': token!},
);
```

---

## ğŸš€ Nginx ë°°í¬ êµ¬ì„±

### ğŸ”¹ Flutter Web ë¹Œë“œ

```bash
flutter build web
```

ë¹Œë“œëœ ê²°ê³¼ëŠ” `frontend/build/web/`ì— ìˆìŒ

---

### ğŸ”¹ Nginx ì„¤ì • ì˜ˆì‹œ (`nginx.conf`)

```nginx
server {
    listen 80;

    server_name yourdomain.com;

    location / {
        root /var/www/frontend/build/web;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    location /api/ {
        proxy_pass http://localhost:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### ğŸ”¹ FastAPI ì‹¤í–‰ (ì˜ˆ: systemd ë˜ëŠ” uvicorn)

```bash
uvicorn main:app --host 0.0.0.0 --port 8000
```

---

## ğŸ§© ì¶”ê°€ íŒ

- **HTTPS**ëŠ” Let's Encrypt + Certbotìœ¼ë¡œ ì ìš©í•˜ì„¸ìš”.
- **DB ê³„ì • ë° ë¹„ë°€ë²ˆí˜¸ëŠ” `.env` íŒŒì¼ ë“±ìœ¼ë¡œ ë¶„ë¦¬**
- **í† í° ê°±ì‹  (Refresh Token)** ê¸°ëŠ¥ì€ ì¶”í›„ í™•ì¥

---

í•„ìš”í•˜ì‹œë©´ GitHub ì—…ë¡œë“œìš© ì „ì²´ ì½”ë“œë„ ë§Œë“¤ì–´ë“œë¦´ê²Œìš”. ì–´ëŠ ë¶€ë¶„ë¶€í„° êµ¬í˜„í•˜ì‹¤ê¹Œìš”? Flutter UI ìª½ë„ í…œí”Œë¦¿ ë§Œë“¤ì–´ë“œë¦´ ìˆ˜ ìˆì–´ìš”.
